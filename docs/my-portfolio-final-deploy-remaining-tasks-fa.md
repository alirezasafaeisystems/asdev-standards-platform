# مستند فنی کارهای باقیمانده برای دیپلوی نهایی `my_portfolio`

## مقدمه

این سند بر اساس گزارش حسابرسی و لیست «تسک‌های اجرایی باقی‌مانده» تهیه شده است. هدف آن ارائه یک برنامه فنی فازبندی‌شده برای آماده‌سازی مخزن `my_portfolio` جهت دیپلوی نهایی است.

این مستند ماهیت عملیاتی دارد و هر وظیفه را همراه با هدف و شاخص پذیرش تعریف می‌کند تا اجرای مراحل پایانی به‌صورت نظام‌مند و قابل ردیابی انجام شود.

## فاز A: رفع مسائل بحرانی (Blocker)

### A1: پاک‌سازی فونت و بهبود اسکن منابع خارجی

- شرح کار: اسکریپت `scripts/offline-external-scan.sh` در وضعیت فعلی برخی لینک‌های فونت یا محتوای HTML/JS خارجی را به‌عنوان خطا گزارش می‌کند و false positive ایجاد می‌شود. مبنای اسکن باید خروجی build (مانند `.next`) باشد و برای منابع مجاز (فونت‌های محلی، نمادها و موارد مشابه) allowlist تعریف شود.
- هدف: اطمینان از سرو کامل فونت‌ها و دارایی‌ها به‌صورت محلی و عبور اسکن بدون هشدار کاذب.
- شاخص پذیرش: اجرای `bash scripts/offline-external-scan.sh` روی خروجی build بدون خطا/هشدار انجام شود و هیچ لینک runtime غیرمجاز به محتوای خارجی در گزارش وجود نداشته باشد.

### A2: حذف دامنه جایگزین و استفاده از پیکربندی

- شرح کار: در فایل‌های `src/app/layout.tsx`، `src/app/robots.ts`، `src/app/sitemap.ts`، `src/app/api/rss/route.ts` و `src/lib/seo.ts` از دامنه جایگزین `https://yourportfolio.com` استفاده شده است. این مقدار باید با دامنه واقعی جایگزین شود یا از پیکربندی (مانند `process.env.NEXT_PUBLIC_BASE_URL`) خوانده شود.
- هدف: حذف کامل hard-coded domain و اتکا به تنظیمات محیط اجرا.
- شاخص پذیرش: جستجوی `yourportfolio.com` در کد هیچ نتیجه‌ای نداشته باشد؛ دامنه از پیکربندی خوانده شود؛ تست‌های SEO و sitemap بدون مشکل اجرا شوند.

## فاز B: افزایش کیفیت کد (Strict Code Quality)

### B1: رفع هشدارهای TypeScript و ESLint

- شرح کار: رفع هشدارهای گزارش‌شده شامل `no-unused-vars`، `no-explicit-any`، `no-console`، `@typescript-eslint/no-non-null-assertion` و `next/no-img-element` و همچنین هشدارهای TypeScript مرتبط با type inference یا متغیرهای ناشناخته.
- هدف: اجرای پروژه در حالت strict بدون warning/error.
- شاخص پذیرش: اجرای `bun run lint`، `bun run type-check` و `bun run build` بدون warning/error و بدون افت پوشش تست.

### B2: رفع خطاهای TS و SEO در کامپوننت‌ها

- شرح کار: اصلاح فایل‌های `src/components/animations/demo.tsx`، `src/components/sections/experience.tsx`، `src/components/sections/testimonials.tsx`، `src/components/theme/theme-provider.tsx`، `src/lib/seo.ts` و `vitest.config.ts` با تمرکز بر حذف `any`، حذف null assertion غیرضروری، و بهبود تنظیمات SEO در اجزای UI.
- هدف: تضمین type-safety در لایه رابط کاربری و تنظیمات تست، همراه با رعایت استاندارد SEO.
- شاخص پذیرش: `bun run type-check` و اجرای Vitest بدون خطا؛ بازبینی کد نشان دهد `any` حذف شده و استانداردهای SEO رعایت می‌شوند.

### B3: اصلاح اسکریپت verify

- شرح کار: اسکریپت `scripts/verify.sh` در برخی سناریوها false failure می‌دهد. منطق تجمیع نتایج lint/test/build باید اصلاح شود تا فقط در خطای واقعی fail کند.
- هدف: بازگشت کد خروجی صفر در موفقیت کامل تمام مراحل verify.
- شاخص پذیرش: اجرای `bash scripts/verify.sh` بعد از اصلاحات بدون خطا/هشدار و با گزارش موفقیت کامل مراحل.

## فاز C: تقویت اصل Local-First

### C1: تعریف allowlist برای اسکن منابع خارجی

- شرح کار: لینک‌های non-runtime (برای مثال شبکه‌های اجتماعی داخل محتوا) در `scripts/offline-external-scan.sh` به‌صورت allowlist مدیریت شوند تا false positive رخ ندهد. allowlist باید قابل توسعه و پیکربندی باشد.
- هدف: حفظ اصل Local-First همراه با دقت بیشتر اسکن و کاهش خطاهای کاذب.
- شاخص پذیرش: لینک‌های مشخص‌شده در allowlist بلاک نشوند، اما لینک‌های غیرمجاز همچنان گزارش شوند.

### C2: اختیاری کردن Telemetry/Analytics

- شرح کار: در `src/components/analytics/web-vitals.tsx` ارسال داده‌های تحلیل کارایی باید با یک پرچم پیکربندی قابل غیرفعال‌سازی باشد و پیش‌فرض آن خاموش باشد.
- هدف: فعال‌سازی telemetry فقط با رضایت صریح کاربر یا مدیر سایت.
- شاخص پذیرش: وجود پرچم (برای مثال `NEXT_PUBLIC_ENABLE_ANALYTICS`) که در حالت `false` هیچ درخواست شبکه‌ای telemetry ارسال نشود؛ تست‌های عملکردی این رفتار را تایید کنند.

## فاز D: تضمین صحت، مستندسازی و رهاسازی

### D1: اجرای verify و offline scan در CI

- شرح کار: اسکریپت‌های `scripts/verify.sh` و `scripts/offline-external-scan.sh` در CI/CD (مانند GitHub Actions) برای هر push/merge روی شاخه اصلی اجرا شوند.
- هدف: جلوگیری از ورود تغییرات غیرقابل‌دیپلوی یا وابستگی خارجی غیرمجاز.
- شاخص پذیرش: در صورت شکست هر اسکریپت، pipeline متوقف شود؛ اجرای یک commit نمونه عبور کامل همه مراحل را نشان دهد.

### D2: به‌روزرسانی مستندات و CHANGELOG

- شرح کار: پس از هر تغییر، `docs/audit/REPORT_FA.md` و `CHANGELOG.md` به‌روزرسانی شوند و اثر تغییرات بر رفتار سیستم/تجربه کاربر ثبت شود.
- هدف: شفافیت تاریخی تغییرات و مرجع قابل اتکا برای بازبینی و پشتیبانی.
- شاخص پذیرش: همه تغییرات جدید در مستندات منعکس شوند و بازبینی تیمی انجام شود.

### D3: ایجاد و تکمیل فایل AGENT.md

- شرح کار: در مخزن `my_portfolio` فایل `AGENT.md` بر اساس استاندارد `asdev_platform` ایجاد یا تکمیل شود (هویت پروژه، فرمان‌های setup/lint/test/build/run، چرخه کاری، تعریف Done، Human Gates، چک‌لیست کیفیت).
- هدف: یک مرجع واحد و استاندارد برای توسعه‌دهندگان و عامل‌های هوش مصنوعی.
- شاخص پذیرش: وجود `AGENT.md` در ریشه مخزن با بخش‌های استاندارد، ارجاع به `AGENTS.md` در صورت نیاز، و تایید مالک محصول.

## نتیجه‌گیری

اجرای موفق این فازها تضمین می‌کند مخزن `my_portfolio` از نظر انطباق با استانداردهای `asdev_platform`، کیفیت کد، Local-First، و مستندسازی برای دیپلوی نهایی آماده باشد. ترتیب پیشنهادی فازها، ریسک استقرار را کاهش می‌دهد و نگهداشت آتی را ساده‌تر می‌کند.
